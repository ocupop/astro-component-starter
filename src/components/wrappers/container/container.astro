---
import SmartImage from "@components/elements/smart-image/smart-image.astro";
import Component from "@components/utils/renderBlock.astro";

const {
  label,
  contentBlocks,
  maxContentWidth,
  paddingHorizontal,
  paddingVertical,
  colorScheme,
  backgroundColor,
  backgroundImage,
  rounded = false,
  class: className,
  ...rest
} = Astro.props;

const {
  source = "",
  alt = "",
  positionVertical = "top",
  positionHorizontal = "center",
  priority = false,
} = backgroundImage || {};

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => key !== "_component")
);

const slugifyLabel = (label: string) => {
  return label
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
};

if (!htmlAttributes.id && label) {
  htmlAttributes.id = slugifyLabel(label);
}
---

<section
  class:list={["container", rounded && "rounded", className]}
  data-theme={colorScheme}
  {...htmlAttributes}
>
  {
    source && (
      <SmartImage
        class:list={[
          "background-image",
          positionVertical && positionHorizontal && `${positionVertical}-${positionHorizontal}`,
        ]}
        source={source}
        alt={alt}
        priority={priority}
        editable={false}
        data-prop-src="backgroundImage.source"
        data-prop-alt="backgroundImage.alt"
        data-editable="image"
      />
    )
  }
  {
    backgroundColor && (
      <div class:list={["background", backgroundColor && `bg-${backgroundColor}`]} />
    )
  }

  <div class="outer-content">
    <div
      class:list={[
        "content",
        paddingHorizontal && `pad-x-${paddingHorizontal}`,
        paddingVertical && `pad-y-${paddingVertical}`,
        maxContentWidth && `max-width-${maxContentWidth}`,
      ]}
    >
      {
        contentBlocks ? (
          <Component contentBlocks={contentBlocks} propName="contentBlocks" />
        ) : (
          <slot />
        )
      }
    </div>
  </div>
</section>
